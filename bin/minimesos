#!/bin/sh

command_exists() {
	command -v "$@" > /dev/null 2>&1
}

if ! command_exists docker; then
	echo "Please install docker to use minimesos"
	exit 1
fi

DOCKER_BIN=/usr/local/bin/docker
if [ ! -f $DOCKER_BIN ]; then
    DOCKER_BIN=/usr/bin/docker
fi

MINIMESOS_TAG="0.4.0"
MESOS_TAG="0.25.0-0.2.70.ubuntu1404"

DOCKER_IMAGES=(
    containersol/minimesos:$MINIMESOS_TAG
    containersol/mesos-agent:$MESOS_TAG
    containersol/mesos-master:$MESOS_TAG
)

for IMAGE in "${DOCKER_IMAGES[@]}"; do
    if [[ "$(docker images -q ${IMAGE%:*} 2> /dev/null)" == "" ]]; then
        echo "Pulling ${IMAGE}" && docker pull "${IMAGE}"
    fi
done

docker run -v $PWD:/tmp/minimesos -v /var/lib/docker:/var/lib/docker -v /var/run/docker.sock:/var/run/docker.sock -v $DOCKER_BIN:$DOCKER_BIN -v /sys/fs/cgroup:/sys/fs/cgroup containersol/minimesos:$MINIMESOS_TAG $@
